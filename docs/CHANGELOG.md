# CHANGELOG.md — Load this file only when reviewing the update log or understanding what changed and when

# Update Log

- **2026-02-12**: Initial documentation. v1.3 multi-skill bundle, skill purity enforcement, add/sub expansion, role-based explanations, estimation visual highlight fix.
- **2026-02-16**: Multi-topic worksheet engine for all Class 3 maths topics. Topic-specific VALID_FORMATS, instruction builders, dedup guards, verify_topics.py.
- **2026-02-17**: Combined add/sub profile with recipes_by_count, enhanced instruction builders, dedup tracking.
- **2026-02-17**: Fix combined add/sub to generate 10 mixed questions in single worksheet (removed from UI_SKILL_TO_CONTRACTS, pass topic to build_worksheet_plan, add thinking to recipes_by_count).
- **2026-02-17**: Phase 1 — Fix the Foundation. Backend: replaced 10 bare except blocks with proper logging across audit, telemetry, mastery_store, worksheets_v1, slot_engine. Fixed _scale_recipe() bug causing incorrect 5-question worksheets. Frontend: added console.warn logging for silent failures in subscription, engagement, profile, api fallback. QA: new test_all_topics.py (48 combinations, 80 checks). Fixed stale test_add_sub_expansion test.
- **2026-02-17**: Phase 3 — Content Expansion. Syllabus: hardcoded CBSE syllabus endpoint GET /api/syllabus/cbse/{grade}/{subject} for Class 1-5 Maths & English (no DB needed). Topics: added 10 Class 2 + 10 Class 4 Maths topic profiles (32 total). 110+ new skill tags, aliases, constraints, and instruction builders. Test suite now covers 128 combinations (200 checks).
- **2026-02-17**: Phase 4 — Production Hardening. Marked 4 dead functions in worksheets.py. Added subscription enforcement (10/month free tier, fail-open on DB errors) via shared subscription_check.py. Frontend: new History page with filters, pagination, PDF download, empty/loading/error states.
- **2026-02-17**: Phase 5+6 — Teacher features + QoL. Backend: POST /api/v1/worksheets/bulk for parallel multi-topic generation (paid only, max 5 topics × 3 each, asyncio.gather). Frontend: answer key show/hide toggle with eye icon, PDF export respects toggle state (full vs student mode).
- **2026-02-17**: Phase 9 Gold-G8 — Premium PDF redesign. Backend: rewrote pdf.py with tiered difficulty sections (Foundation/Application/Stretch), Name/Date/Score header, professional footer with page numbers + branding, 2cm margins, hint text for thinking/ED questions, alternate-row answer key shading. Frontend: added tier grouping to worksheet view based on question role field, print-only Name/Date/Score header, Nunito font import for child-friendly print typography, updated print CSS to 20mm margins.
- **2026-02-17**: Phase 9 Gold-G5 — Learning Objective Header. Added LEARNING_OBJECTIVES dict (32 topics, 3 objectives each) + get_learning_objectives() to slot_engine.py. Added learning_objectives field to Worksheet/WorksheetV1 models and wired into all 4 generation endpoints. Frontend: styled "Today's Learning Goal" box with checkmarks above instructions. PDF: bordered objective box rendered below title.
- **2026-02-17**: Phase 9 Gold-G6 — Hint System. Frontend: collapsible "Show Hint" button on thinking and error_detection questions. Click reveals hint in warm amber box. In print mode, revealed hints render as subtle grey boxes. No backend changes — data already exists in explanation field.
- **2026-02-17**: Phase 9 Gold-G1 — Tiered Difficulty with Star Badges. Frontend: star badges (1/2/3 stars) below question numbers in tiered view indicating Foundation/Application/Stretch. PDF: star badges rendered inline next to question numbers in amber accent colour. Tier headers + sorting already done in G8.
- **2026-02-17**: Phase 9 Gold-G3 + Gold-G4 — Indian context bank (32 topics × 10 contexts) + 5 new SVG visual types (pie_fraction, grid_symmetry, money_coins, pattern_tiles, abacus) with backend hydration rules.
- **2026-02-17**: Phase 9 Gold-G2 — Mastery-aware slot plan modifier. `_get_mastery_for_topic()` aggregates mastery states; `adjust_slot_plan_for_mastery()` boosts thinking for mastered / recognition for learning; `_ERROR_TYPE_CONSTRAINTS` injects targeted practice. `child_id` flows through all generation endpoints. Frontend: mastery badge on personalised worksheets.
- **2026-02-17**: Phase 9 Gold-G7 — Parent Insight Footer. Backend: `WATCH_FOR_MESSAGES` (10 error types) and `NEXT_STEP_MESSAGES` (4 levels, topic-specific) + `build_parent_insight()` injected into attempt response. `ParentInsight` model added to AttemptResponse. Frontend: insight footer on worksheet with watch-for, next-step, mastery progress bar + streak.
- **2026-02-17**: Phase 9 Gold-G3 — Indian Context Word Problems. Added TOPIC_CONTEXT_BANK (32 topics × 10 contexts each) with rich Indian scenarios (cricket, Diwali, mela, auto-rickshaw, etc.). Injected into _build_slot_instruction() for application slots — LLM uses Indian names and contexts instead of generic problems.
- **2026-02-17**: Phase 9 Gold-G4 — Rich Visual Types. Backend: 5 new hydration rules in hydrate_visuals() for PIE_FRACTION, GRID_SYMMETRY, MONEY_COINS, PATTERN_TILES, ABACUS — mapped by question format. Added to _MODEL_TO_VTYPE. Frontend: 5 new SVG components (PieFractionVisual, GridSymmetryVisual, MoneyCoinsVisual, PatternTilesVisual, AbacusVisual) in VisualProblem.tsx — all print-safe, B&W friendly, accessible.
- **2026-02-17**: Phase 7 — English Language Engine. Multi-subject support: 22 English topic profiles (6 Class 2, 8 Class 3, 8 Class 4) with VALID_FORMATS_ENGLISH, subject-aware validate_question/enforce_slot_counts/backfill_format, QUESTION_SYSTEM_ENGLISH prompt, 80+ eng_* skill tags, 15 instruction builder blocks, 45 aliases, 22 constraints/objectives/context banks. Frontend: grade-aware English topic selector. Zero Maths regression (709+282 deterministic checks pass).
- **2026-02-17**: Phase 10A — Maths Class 1 (8 topics). Backend: 8 new topic profiles (Numbers 1-50, Numbers 51-100, Addition up to 20, Subtraction within 20, Basic Shapes, Measurement, Time, Money) with strict grade constraints (sums ≤20, no carry/borrow, no standard units, coins only). 40 skill tags, 30 aliases, 8 constraints, 8×3 learning objectives, 8×10 Indian context bank entries, 8 instruction builder blocks. Frontend: grade-aware Maths topic selector + Class 1 on landing page. QA: test_class1_maths.py (82 checks). verify_topics: 909 passed.
- **2026-02-17**: Phase 10B+10C+10D — Maths Class 2 guardrails, Class 4 completion, Class 5 (10 new topics). Backend: Added missing _TOPIC_CONSTRAINTS for 3 arithmetic topics (Class 2 add/sub, Class 4 add/sub). Added 10 new Class 5 topic profiles (Numbers up to 10 lakh, Factors & Multiples, HCF & LCM, Fractions add/sub, Decimals all ops, Percentage, Area & Volume, Geometry circles/symmetry, Data handling pie charts, Speed distance time). 50 new skill tags, 38 aliases, 10 constraints, 30 learning objectives, 100 Indian context bank entries, 10 instruction builder blocks. Frontend: Class 5 Maths topics in grade selector + landing page. QA: test_class2/4/5_maths.py (99+101+98=298 checks). verify_topics: 1009 passed.
- **2026-02-17**: Phase 8 — Science Engine. 7 Class 3 Science topic profiles (Plants, Animals, Food and Nutrition, Shelter, Water, Air, Our Body) with VALID_FORMATS_SCIENCE (18 formats), QUESTION_SYSTEM_SCIENCE prompt, 35 sci_* skill tags, 7 instruction builder blocks, 25 aliases, 7 constraints/objectives/context banks (Indian contexts). Frontend: grade-aware Science topic selector. Pipeline: text-only rendering (like English), reuses text answer normalizer. QA: 169-check test suite (28 combinations), zero regression (779+282+169 = 1,230 deterministic checks pass).
- **2026-02-17**: P2 Growth Features — 3 parallel features. (1) Parent Progress Dashboard: rewrote dashboard_service.py to work without missing DB views (graceful fallback to worksheets table), new ParentDashboard.tsx with stats cards + skill progress table + recent topics, "Progress" tab in parent nav. (2) WhatsApp Share: new share.py router (POST /api/worksheets/{id}/share + GET /api/shared/{token}), share_tokens table, WhatsApp + copy-link buttons in worksheet toolbar, SharedWorksheet.tsx public viewer with no-auth route. (3) Hindi Language Engine: 5 Class 3 Hindi topic profiles (Varnamala, Matras, Shabd Rachna, Vakya Rachna, Kahani Lekhan) with VALID_FORMATS_HINDI (17 formats), QUESTION_SYSTEM_HINDI (Devanagari script), 25 hin_* skill tags, 5 instruction builders, 21 aliases, 5 constraints/objectives/context banks. QA: 138-check test suite, zero regression (829+282+169+138 = 1,418 checks pass).
- **2026-02-17**: Fixed teacher routing bug (isTeacherPage missing generator) and free tier silent blocking — users now see remaining count and upgrade prompt before generation, generate button replaced with upgrade CTA at limit. E2E test suite: 26/26 pass.
- **2026-02-17**: Phase 11A — English Class 1 (7 topics). Backend: 7 new English topic profiles (Alphabet, Phonics, Self and Family Vocabulary, Animals and Food Vocabulary, Greetings and Polite Words, Seasons, Simple Sentences) with subject="English", grade constraints (3-letter CVC words, no grammar rules, picture-based). 35 eng_c1_* skill tags, 28 aliases, 7 constraints, 21 learning objectives, 70 Indian context bank entries, 7 instruction builder blocks. Frontend: Class 1 English in grade selector + landing page. QA: test_class1_english.py (77 checks). verify_topics: 1079 passed. Total: 91 topic profiles.
- **2026-02-17**: World-class landing page (Landing.tsx). 12 sections: sticky nav, hero with animated underline + floating worksheet preview, social proof bar, problem statement, Gold Class 6-step tabbed stepper, subjects explorer (66 topics across Maths/English/Science), comparison table vs free tools, parent/teacher cards, pricing (Free + ₹299/mo), philosophy, final CTA, footer. Playfair Display serif headings, academic dot-grid pattern, IntersectionObserver scroll-reveal animations, mobile-responsive. Replaces old LandingPage.tsx. 26/26 E2E pass, zero lint errors.
- **2026-02-17**: Phase 11B — English Class 5 (9 topics). Backend: 9 new English topic profiles (Active and Passive Voice, Direct and Indirect Speech, Complex Sentences, Summary Writing, Comprehension, Synonyms and Antonyms, Formal Letter Writing, Creative Writing, Clauses) with subject="English", advanced grade constraints. 45 eng_c5_* skill tags, 33 aliases, 9 constraints, 27 learning objectives, 90 Indian context bank entries, 9 instruction builder blocks. QA: test_class5_english.py (99 checks). Total: 103 profiles.
- **2026-02-17**: Phase 12A — EVS Class 1 & 2 (12 topics). Backend: 12 new Science topic profiles (6 Class 1: My Family, My Body, Plants Around Us, Animals Around Us, Food We Eat, Seasons and Weather; 6 Class 2: Plants, Animals and Habitats, Food and Nutrition, Water, Shelter, Our Senses) with subject="Science", EVS-specific constraints (disallow maths keywords). 60 sci_c1_*/sci_c2_* skill tags, 53 aliases, 12 constraints, 36 learning objectives, 120 Indian context bank entries, 12 instruction builder blocks. Frontend: EVS Class 1 & 2 in Science grade selector + landing page. QA: test_class12_evs.py (132 checks). verify_topics: 1289 passed. Total: 112 topic profiles.
- **2026-02-17**: Phase 12B — Science Class 4 & 5 (14 topics). Backend: 14 new Science topic profiles (7 Class 4: Living Things, Human Body, States of Matter, Force and Motion, Simple Machines, Photosynthesis, Animal Adaptation; 7 Class 5: Circulatory System, Respiratory and Nervous System, Reproduction in Plants and Animals, Physical and Chemical Changes, Forms of Energy, Solar System and Earth, Ecosystem and Food Chains). 70 sci_c4_*/sci_c5_* skill tags, 67 aliases, 14 constraints, 42 learning objectives, 140 Indian context bank entries, 14 instruction builder blocks. Frontend: Science Class 4 & 5 in grade selector + landing page. QA: test_class45_science.py (154 checks). verify_topics: 1429 passed. Total: 126 topic profiles.
- **2026-02-17**: Phase 13 — Computer Science (15 topics, Class 1-5). Backend: 15 new Computer topic profiles (2 Class 1: Parts of Computer, Mouse and Keyboard; 3 Class 2: Desktop and Icons, Basic Typing, Special Keys; 3 Class 3: MS Paint, Keyboard Shortcuts, Files and Folders; 3 Class 4: MS Word, Scratch Intro, Internet Safety; 4 Class 5: Scratch Programming, Internet Basics, MS PowerPoint, Digital Citizenship). Subject="Computer" with Science format reuse, subject-aware lookups updated. 75 comp_* skill tags, 58 aliases, 15 constraints, 45 learning objectives, 150 Indian context bank entries, 15 instruction builder blocks. Frontend: Computer in grade selectors + landing page subject tabs. QA: test_computer.py (165 checks). verify_topics: 1579 passed. Total: 141 topic profiles.
- **2026-02-17**: Phase 14+15 — GK (12 topics) + Moral Science (10 topics). Backend: 12 GK topic profiles (4 Class 3: Famous Landmarks, National Symbols, Solar System Basics, Current Awareness; 4 Class 4: Continents and Oceans, Famous Scientists, Festivals of India, Sports and Games; 4 Class 5: Indian Constitution, World Heritage Sites, Space Missions, Environmental Awareness) + 10 Moral Science topic profiles (2 Class 1: Sharing, Honesty; 2 Class 2: Kindness, Respecting Elders; 3 Class 3: Teamwork, Empathy, Environmental Care; 1 Class 4: Leadership; 2 Class 5: Global Citizenship, Digital Ethics). Subject="GK"/"Moral Science" with Science format reuse, subject-aware lookups updated. 110 gk_*/moral_* skill tags, 88 aliases, 22 constraints, 66 learning objectives, 220 Indian context bank entries, 22 instruction builder blocks. Frontend: GK + Moral Science in grade selectors + landing page subject tabs. QA: test_gk.py (132 checks) + test_moral_science.py (110 checks). verify_topics: 1799 passed. Total: 163 topic profiles.
- **2026-02-17**: Phase 16 — Health & Physical Education (15 topics, Class 1-5). Backend: 15 new Health topic profiles (3 Class 1: Personal Hygiene, Good Posture, Basic Physical Activities; 3 Class 2: Healthy Eating Habits, Outdoor Play, Basic Stretching; 3 Class 3: Balanced Diet, Team Sports Rules, Safety at Play; 3 Class 4: First Aid Basics, Yoga Introduction, Importance of Sleep; 3 Class 5: Fitness and Stamina, Nutrition Labels Reading, Mental Health Awareness). Subject="Health" with Science format reuse, subject-aware lookups updated. 75 health_* skill tags, 58 aliases, 15 constraints, 45 learning objectives, 150 Indian context bank entries, 15 instruction builder blocks. Frontend: Health in grade selectors + landing page subject tabs. QA: test_health.py (165 checks). verify_topics: 1949 passed. Total: 178 topic profiles.
- **2026-02-17**: Phase 18 — Hindi Expansion (19 topics, Class 1/2/4/5). Backend: 19 new Hindi topic profiles (4 Class 1: Varnamala Swar, Varnamala Vyanjan, Family Words, Simple Sentences; 5 Class 2: Matras Introduction, Two Letter Words, Three Letter Words, Rhymes and Poems, Nature Vocabulary; 5 Class 4: Anusvaar and Visarg, Vachan and Ling, Kaal, Patra Lekhan, Comprehension Hindi; 5 Class 5: Muhavare, Paryayvachi Shabd, Vilom Shabd, Samas, Samvad Lekhan). Subject="Hindi" with VALID_FORMATS_HINDI, Devanagari script throughout. 95 hin_c1_*/hin_c2_*/hin_c4_*/hin_c5_* skill tags, 72 aliases, 19 constraints, 57 learning objectives, 190 Indian context bank entries, 19 instruction builder blocks. Frontend: Hindi Class 1-5 in grade selectors + landing page subject tabs. QA: test_hindi_expansion.py (209 checks). verify_topics: 2129 passed. Total: 196 topic profiles.
- **2026-02-18**: Reorganised CLAUDE.md into docs/ subdirectory to reduce context load. CLAUDE.md is now <5k chars; full content lives in docs/CURRICULUM.md, docs/SCHEMA.md, docs/RULES.md, docs/PHASES.md, docs/CHANGELOG.md.
